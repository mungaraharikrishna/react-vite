import{r as i,_ as v,j as e,u as E,B,N as $}from"./index-B6OC0NlP.js";import{c as S,a as w,F as z,b as y,d as b,A as R,L as V}from"./auth.service-B7lSlvCY.js";import{A,B as j,U as a}from"./utils.service-D6i7PkGU.js";import"./index-BZ81SVx3.js";const _="/react-vite/assets/msrcosmos_logo-BuQEwmq5.svg";var k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"};const F=k;var I=function(o,n){return i.createElement(A,v({},o,{ref:n,icon:F}))};const T=i.forwardRef(I);var Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M759 335c0-137-111-248-248-248S263 198 263 335c0 82.8 40.6 156.2 103 201.2-.4.2-.7.3-.9.4-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00136 874.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C356 614.2 431 583 511 583c137 0 248-111 248-248zM511 507c-95 0-172-77-172-172s77-172 172-172 172 77 172 172-77 172-172 172zm105 221h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H703.5l47.2-60.1a8.1 8.1 0 001.7-4.9c0-4.4-3.6-8-8-8h-72.6c-4.9 0-9.5 2.3-12.6 6.1l-68.5 87.1c-4.4 5.6-6.8 12.6-6.8 19.8.1 17.7 14.4 32 32.1 32zm240 64H592c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h176.5l-47.2 60.1a8.1 8.1 0 00-1.7 4.9c0 4.4 3.6 8 8 8h72.6c4.9 0 9.5-2.3 12.6-6.1l68.5-87.1c4.4-5.6 6.8-12.6 6.8-19.8-.1-17.7-14.4-32-32.1-32z"}}]},name:"user-switch",theme:"outlined"};const P=Z;var M=function(o,n){return i.createElement(A,v({},o,{ref:n,icon:P}))};const H=i.forwardRef(M);function Q({onFormSubmit:m}){const o={userName:""},n=S({userName:w().required("Required").matches(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,"Enter valid email")}),d=(t,h)=>{h.setSubmitting(!0),R.verifyUser(t).then(l=>{const c=l.data;if(c&&c.statusCode===200){const g={authrole:c.authRole,username:t.userName};a.setCookies(g),m(t)}}).catch(l=>{console.log(l)}).finally(()=>{h.setSubmitting(!1)})};return e.jsx(e.Fragment,{children:e.jsx(z,{initialValues:o,enableReinitialize:!0,validationSchema:n,onSubmit:d,children:t=>e.jsx(y,{noValidate:!0,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{children:e.jsx(b,{control:"input",type:"email",label:"Username",name:"userName",placeholder:"Enter username",isshowlabel:"false",isshowicon:"true",isshowerrmsg:"false",status:t.touched&&t.touched.userName&&t.errors&&t.errors.userName?"error":""})}),e.jsx("div",{children:e.jsx(j,{htmlType:"submit",type:"primary",className:"float_right",icon:e.jsx(T,{}),size:"large",block:!0,loading:t.isSubmitting,children:"Proceed"})})]})})})})}function X(){const m=E(),[o,n]=i.useState({userName:"",password:""}),[d,t]=i.useState(a.getCookieByName("username")),[h,l]=i.useState(a.getCookieByName("authrole")),[c,g]=i.useState(!1),L=S({userName:w().required("Required").matches(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,"Enter valid email"),password:w().required("Required")}),U=s=>{console.log(s),t(a.getCookieByName("username")),l(a.getCookieByName("authrole")),g(!0)},D=s=>{const x={access_token:s.jwtResponse.accessToken};let u=[];const r={},f={};s.organizationListDto&&s.organizationListDto.length&&(u=s.organizationListDto.reduce((N,p)=>(N.push({organizationName:p.organizationName,id:p.id,status:p.status}),N),[])),s.organizationRequestDto&&Object.keys(s.organizationRequestDto).length&&(r.organizationName=s.organizationRequestDto.organizationName,r.organizationId=s.organizationRequestDto.organizationId),s.bussinessUnitListDto&&s.bussinessUnitListDto.length&&(f.name=s.bussinessUnitListDto[0].name,f.id=s.bussinessUnitListDto[0].id,f.organizationId=s.bussinessUnitListDto[0].organizationIds);const C={menu:s.menu,organizationList:u,organization:r,roles:s.roles,bussinessUnit:f,name:`${s.firstName} ${s.lastName}`,phonenumber:s.phonenumber};a.setCookies(x),a.setLocalStorage(C)},O=(s,x)=>{x.setSubmitting(!0),R.login(s).then(u=>{const r=u.data;r&&r.statusCode===200&&(D(r.userRequestDto),B.success(r.message),m($.routePaths.dashboard))}).catch(u=>{console.log(u)}).finally(()=>{x.setSubmitting(!1)})},q=()=>{a.removeFromCookie(),g(!1)};return i.useEffect(()=>{d&&h?(n({userName:d,password:""}),g(!0)):(t(""),l(""))},[d,h]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex min-h-full flex-col justify-center sm:p-0 md:p-4 lg:p-12 xl:p-16 2xl:p-32",children:[e.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-sm",children:e.jsx("img",{className:"h-14 w-auto",src:"https://ticketing-web-uat.azurewebsites.net/assets/img/ticketing-logo.svg",alt:"Logo"})}),e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-sm",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium text-base",children:"Welcome To Ticketing System"}),e.jsx("div",{className:"font-light text-xs text-slate-400",children:"Provide your email and proceed to Sign In."})]}),!c&&e.jsx(Q,{onFormSubmit:U}),c&&e.jsx(z,{initialValues:o,enableReinitialize:!0,validationSchema:L,onSubmit:O,children:s=>e.jsx(y,{noValidate:!0,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{children:e.jsx(b,{control:"input",type:"email",label:"Username",name:"userName",placeholder:"Enter userame",isshowlabel:"false",isshowerrmsg:"false",isshowicon:"true",isdisabled:"true",status:s.touched&&s.touched.userName&&s.errors&&s.errors.userName?"error":""})}),e.jsx("div",{children:e.jsx(b,{control:"password",type:"password",label:"Password",name:"password",placeholder:"Enter password",isshowlabel:"false",isshowerrmsg:"false",isshowicon:"true",status:s.touched&&s.touched.password&&s.errors&&s.errors.password?"error":""})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(j,{htmlType:"submit",type:"primary",className:"float_right",icon:e.jsx(V,{}),size:"large",loading:s.isSubmitting,block:!0,children:"Sign in"}),e.jsx(j,{type:"link",className:"float_right",icon:e.jsx(H,{}),size:"large",onClick:()=>q(),block:!0,children:"Switch Account"})]})]})})}),e.jsxs("div",{className:"mt-10 flex flex-col justify-center items-center",children:[e.jsx("div",{className:"text-gray-400 text-xs mb-1 mt-5",children:"Powered by"}),e.jsx("img",{src:_,alt:"MSRcosmos",className:"h-12"})]})]})]})})}export{X as default};
